{% extends "base.html" %} {% block title %} Status {% endblock %} {% block
    styles %}
    
    <style type="text/css">
        .box {
            border: 2px solid #69b4ff;
            border-radius: 4px;
            margin: 2em 0;
            padding: 20px;
            position: relative;
        }
    
        .box::before {
            background-color: #fff;
            color: #69b4ff;
            content: attr(data-before);
            font-weight: bold;
            left: 1em;
            padding: 0 0.5em;
            position: absolute;
            top: -1em;
        }
    
        .cduStatus,
        .pumpValve,
        .fanValve,
        .mcInfo,
        .evStatus,
        .deviceStatus,
        .sensor,
        .communication,
        .brokenStatus,
        .rack_setting,
        .showcase,
        .switch_version,
        .cduInfo {
            border: 2px solid #008000;
    
            border-radius: 10px;
            margin: 2em 0;
            padding: 20px;
            position: relative;
        }
    
        .cduStatus::before,
        .pumpValve::before,
        .evStatus::before,
        .deviceStatus::before,
        .sensor::before,
        .communication::before,
        .brokenStatus::before,
        .rack_setting::before,
        .showcase::before,
        .switch_version::before,
        .cduInfo::before,
        .fanValve::before,
        .mcInfo::before {
            background-color: #fff;
            color: #000000;
            content: attr(data-before);
            font-weight: bold;
            left: 1em;
            padding: 0 0.5em;
            position: absolute;
            top: -1em;
        }
    
        .tdCenterAlign {
            text-align: center;
        }
    
        .navbar .navbar-nav .nav-link:hover {
            background-color: #778899;
            color: #fff;
        }
    
        .nav-status {
            background-color: #008000 !important;
            color: #fff !important;
        }
    
        .hidden {
            display: none;
        }
    
        .row_sticky {
            position: sticky;
            top: 90px;
            background-color: white;
            padding: 10px 0px;
            z-index: 99;
        }
    
        .title.collapsed .content {
            display: none;
        }
    
        .data-before-trigger {
            position: absolute;
            top: -14px;
            left: 21px;
            width: 355px;
            height: 22px;
            cursor: pointer;
        }
    
        .title::before {
            content: attr(data-before);
        }
    
        td {
            text-align: center;
        }
    
        .detail {
            display: flex;
            justify-content: center;
            padding-bottom: 20px;
        }
    
        .scrollable-image-container {
            width: 100%;
            overflow-x: auto;
        }
    
        .scrollable-image-container .image {
            max-width: 100%;
            width: auto;
            height: auto;
        }
    
        .machine {
            width: 1700px;
            border: 2px solid black;
        }
    
        .unit_block {
            font-size: 16px;
            font-weight: 500;
            position: absolute;
            left: 1460px;
            top: 10px;
            padding: 5px;
            display: flex;
            text-align: center;
            width: 230px;
        }
    
        .image {
            position: relative;
        }
    
        .status_light {
            background-color: black;
            border-radius: 10px;
            width: 15px;
            height: 15px;
            position: absolute;
            top: 50%;
            left: 40%;
            transform: translateY(-50%);
        }
    
        .image_value_border {
            position: absolute;
            border: 2px solid green;
            border-radius: 5px;
            height: 25px;
            width: 78px;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            white-space: nowrap;
            justify-content: center;
            padding: 2px;
            gap: 3px;
        }
    </style>
    {% endblock %} {% block content %}
    <div class="container-fluid" style="margin-top: 100px; margin-bottom: 60px">
        <div class="pic_1920 detail scrollable-image-container">
            <div class="image">
                <div style="width: 1700px; height: 900px">
                    <img class="machine" src="../static/images/full_picture.png" alt="設備" loading="eager" />
                </div>
                <!-- 顯示TDp數值框 -->
                <div class="image_value_border" style="top: 35px; left:200px">
                    <span class="dew_point_image" id="dew_point_image">N/A</span>
                    <span class="unit_temp image"></span>
                </div>
                <!-- 顯示Ta數值框 -->
                <div class="image_value_border" style="top: 80px; left:200px">
                    <span class="ambient_temp_image" id="ambient_temp_image">N/A</span>
                    <span class="unit_temp image"></span>
                </div>
                <!-- 顯示T1數值框 -->
                <div class="image_value_border" style="top: 190px; left:310px">
                    <span class="temp_clntSply_image" id="temp_clntSply_image">N/A</span>
                    <span class="unit_temp image"></span>
                </div>
                <!-- 顯示P1數值框 -->
                <div class="image_value_border" style="top: 190px; left:470px">
                    <span class="prsr_clntSply_image" id="prsr_clntSply_image">N/A</span>
                    <span class="unit_pressure image"></span>
                </div>
                <!-- 顯示PD數值框 -->
                <div class="image_value_border" style="top: 255px; left:470px">
                    <span class="prsr_diff_image" id="prsr_diff_image">N/A</span>
                    <span class="unit_pressure image"></span>
                </div>
                <!-- 顯示Tur數值框 -->
                <div class="image_value_border" style="top: 365px; left:812px">
                    <span class="tbd_image" id="tbd_image">N/A</span>
                    <span class="Tur_unit" id="Tur_unit">NTU</span>
                </div>
                <!-- 顯示CON數值框 -->
                <div class="image_value_border" style="top: 365px; left:902px">
                    <span class="cdct_image" id="cdct_image">N/A</span>
                    <span class="CON_unit" id="CON_unit">μS/cm</span>
                </div>
                <!-- 顯示PH數值框 -->
                <div class="image_value_border" style="top: 365px; left:992px">
                    <span class="pH_image" id="pH_image">N/A</span>
                    <span class="pH_unit" id="pH_unit">pH</span>
                </div>
                <!-- 顯示fan 1-8 數值框 -->
                <div class="image_value_border" style="top: 275px; left:1250px">
                    <span class="fan_freq_image" id="fan_freq1_image">N/A</span>
                    <span class="fan_unit">%</span>
                </div>
                <div class="image_value_border" style="top: 315px; left:1250px">
                    <span class="fan_freq_image" id="fan_freq2_image">N/A</span>
                    <span class="fan_unit">%</span>
                </div>
                <div class="image_value_border" style="top: 355px; left:1250px">
                    <span class="fan_freq_image" id="fan_freq3_image">N/A</span>
                    <span class="fan_unit">%</span>
                </div>
                <div class="image_value_border" style="top: 395px; left:1250px">
                    <span class="fan_freq_image" id="fan_freq4_image">N/A</span>
                    <span class="fan_unit">%</span>
                </div>
                <div class="image_value_border" style="top: 275px; left:1560px">
                    <span class="fan_freq_image" id="fan_freq5_image">N/A</span>
                    <span class="fan_unit">%</span>
                </div>
                <div class="image_value_border" style="top: 315px; left:1560px">
                    <span class="fan_freq_image" id="fan_freq6_image">N/A</span>
                    <span class="fan_unit">%</span>
                </div>
                <div class="image_value_border" style="top: 355px; left:1560px">
                    <span class="fan_freq_image" id="fan_freq7_image">N/A</span>
                    <span class="fan_unit">%</span>
                </div>
                <div class="image_value_border" style="top: 395px; left:1560px">
                    <span class="fan_freq_image" id="fan_freq8_image">N/A</span>
                    <span class="fan_unit">%</span>
                </div>
                <!-- 顯示T2數值框 -->
                <div class="image_value_border" style="top: 690px; left:153px">
                    <span class="temp_clntRtn_image" id="temp_clntRtn_image">N/A</span>
                    <span class="unit_temp image"></span>
                </div>
                <!-- 顯示P2數值框 -->
                <div class="image_value_border" style="top: 690px; left:268px">
                    <span class="prsr_clntRtn_image" id="prsr_clntRtn_image">N/A</span>
                    <span class="unit_pressure image"></span>
                </div>
                <!-- 顯示Pump1數值框 -->
                <div class="image_value_border" style="top: 535px; left:620px">
                    <span class="inv1_freq_image" id="inv1_freq_image">N/A</span>
                    <span class="inv_unit" id="inv1_unit">%</span>
                </div>
                <!-- 顯示Pump2數值框 -->
                <div class="image_value_border" style="top: 690px; left:620px">
                    <span class="inv2_freq_image" id="inv2_freq_image">N/A</span>
                    <span class="inv_unit" id="inv1_unit">%</span>
                </div>
                <!-- 顯示Pump3數值框 -->
                <div class="image_value_border" style="top: 840px; left:620px">
                    <span class="inv3_freq_image" id="inv3_freq_image">N/A</span>
                    <span class="inv_unit" id="inv1_unit">%</span>
                </div>
                <!-- 顯示P4數值框 -->
                <div class="image_value_border" style="top: 690px; left:955px">
                    <span class="prsr_fltOut_image" id="prsr_fltOut_image">55</span>
                    <span class="unit_pressure image"></span>
                </div>
                <!-- 顯示Filtter數值框 -->
                <div class="image_value_border" style="top: 690px; left:1070px">
                    <span class="prsr_fltDiffa_image" id="prsr_fltDiff_image">N/A</span>
                </div>
                <!-- 顯示P3數值框 -->
                <div class="image_value_border" style="top: 690px; left:1190px">
                    <span class="prsr_fltIn_image" id="prsr_fltIn_image">N/A</span>
                    <span class="unit_pressure image"></span>
                </div>
                <!-- 顯示F1數值框 -->
                <div class="image_value_border" style="top: 690px; left:1305px">
                    <span class="clnt_flow_image" id="clnt_flow_image">N/A</span>
                    <span class="unit_flow image"></span>
                </div>
    
                <div class="unit_block">
                    <table class="table table-striped table-hover">
                        <tbody>
                            <tr>
                                <td scope="row">CDU Status:</td>
                                <td scope="row" style="position: relative" class="light_box">
                                    <div class="status_light" id="status_light"></div>
                                </td>
                            </tr>
                            <tr>
                                <td scope="row">Operation Mode:</td>
                                <td id="current_mode" class="current_mode" scope="row"></td>
                            </tr>
                            <tr>
                                <td scope="row">PLC:</td>
                                <td id="PLC" class="PLC" scope="row"></td>
                            </tr>
                            <tr>
                                <td scope="row">PC Box:</td>
                                <td>Main</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    
        <div class="sensor title" data-label="Sensor Value">
            <div class="data-before-trigger"></div>
            <div class="content">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr class="row_sticky">
                            <th class="col-4 tdCenterAlign" scope="col">Sensor</th>
                            <th class="col-3 tdCenterAlign">Status</th>
                            <th class="col-3 tdCenterAlign">Value</th>
                            <th class="col-2 tdCenterAlign">Unit</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="tdCenterAlign" scope="row">
                                Coolant Supply Temperature (T1)
                            </td>
                            <td id="temp_clntSply_status" class="tdCenterAlign" scope="row"></td>
                            <td id="temp_clntSply" class="tdCenterAlign" scope="row"></td>
                            <td class="unit_temp tdCenterAlign" scope="row"></td>
                        </tr>
                        <tr class="t1sp_set">
                            <td class="tdCenterAlign" scope="row">
                                Coolant Supply Temperature Spare (T1sp)
                            </td>
                            <td id="temp_clntSplySpare_status" class="tdCenterAlign" scope="row"></td>
                            <td id="temp_clntSplySpare" class="tdCenterAlign" scope="row"></td>
                            <td class="unit_temp tdCenterAlign" scope="row"></td>
                        </tr>
                        <tr>
                            <td class="tdCenterAlign" scope="row">
                                Coolant Return Temperature (T2)
                            </td>
                            <td id="temp_clntRtn_status" class="tdCenterAlign" scope="row"></td>
                            <td id="temp_clntRtn" class="tdCenterAlign" scope="row"></td>
                            <td class="tdCenterAlign unit_temp" scope="row"></td>
                        </tr>
                        <tr>
                            <td class="tdCenterAlign" scope="row">
                                Coolant Return Temperature Spare (T2sp)
                            </td>
                            <td id="temp_clntRtnSpare_status" class="tdCenterAlign" scope="row"></td>
                            <td id="temp_clntRtnSpare" class="tdCenterAlign" scope="row"></td>
                            <td class="tdCenterAlign unit_temp" scope="row"></td>
                        </tr>
                        <tr>
                            <td class="tdCenterAlign" scope="row">
                                Coolant Supply Pressure (P1)
                            </td>
                            <td id="prsr_clntSply_status" class="tdCenterAlign" scope="row"></td>
                            <td id="prsr_clntSply" class="tdCenterAlign" scope="row"></td>
                            <td class="unit_pressure tdCenterAlign" scope="row"></td>
                        </tr>
                        <tr class="p1sp_set">
                            <td class="tdCenterAlign" scope="row">
                                Coolant Supply Pressure Spare (P1sp)
                            </td>
                            <td id="prsr_clntSplySpare_status" class="tdCenterAlign" scope="row"></td>
                            <td id="prsr_clntSplySpare" class="tdCenterAlign" scope="row"></td>
                            <td class="unit_pressure tdCenterAlign" scope="row"></td>
                        </tr>
                        <tr>
                            <td class="tdCenterAlign" scope="row">
                                Coolant Return Pressure (P2)
                            </td>
                            <td id="prsr_clntRtn_status" class="tdCenterAlign" scope="row"></td>
                            <td id="prsr_clntRtn" scope="row"></td>
                            <td class="unit_pressure" scope="row"></td>
                        </tr>
                        <tr class="t2sp_set">
                            <td class="tdCenterAlign" scope="row">
                                Coolant Return Pressure Spare (P2sp)
                            </td>
                            <td id="prsr_clntRtnSpare_status" class="tdCenterAlign" scope="row"></td>
                            <td id="prsr_clntRtnSpare" scope="row"></td>
                            <td class="unit_pressure" scope="row"></td>
                        </tr>
                        <tr class="t2sp_set">
                            <td class="tdCenterAlign" scope="row">
                                Differential Pressure (Pd)
                            </td>
                            <td class="tdCenterAlign" scope="row">-</td>
                            <td id="prsr_diff" scope="row"></td>
                            <td class="unit_pressure" scope="row"></td>
                        </tr>
    
                        <tr>
                            <td class="tdCenterAlign" scope="row">
                                Coolant Flow Rate (F1)
                            </td>
                            <td id="clnt_flow_status" class="tdCenterAlign" scope="row"></td>
                            <td id="clnt_flow" scope="row"></td>
                            <td class="unit_flow" scope="row"></td>
                        </tr>
                        <tr>
                            <td class="tdCenterAlign" scope="row">
                                Ambient Temperature (Ta)
                            </td>
                            <td id="ambient_temp_status" class="tdCenterAlign" scope="row"></td>
                            <td id="ambient_temp" scope="row"></td>
                            <td class="unit_temp" scope="row"></td>
                        </tr>
                        <tr>
                            <td class="tdCenterAlign" scope="row">
                                Relative Humidity (RH)
                            </td>
                            <td id="relative_humid_status" class="tdCenterAlign" scope="row"></td>
                            <td id="relative_humid" scope="row"></td>
                            <td class="" scope="row">%</td>
                        </tr>
                        <tr>
                            <td class="tdCenterAlign" scope="row">
                                Dew Point Temperature (TDp)
                            </td>
                            <td id="dew_point_status" class="tdCenterAlign" scope="row"></td>
                            <td id="dew_point" scope="row"></td>
                            <td class="unit_temp" scope="row"></td>
                        </tr>
    
                        <tr>
                            <td class="tdCenterAlign" scope="row">pH (PH)</td>
                            <td id="pH_status" class="tdCenterAlign" scope="row"></td>
                            <td id="pH" scope="row"></td>
                            <td scope="row">pH</td>
                        </tr>
                        <tr>
                            <td class="tdCenterAlign" scope="row">
                                Conductivity (CON)
                            </td>
                            <td id="cdct_status" class="tdCenterAlign" scope="row"></td>
                            <td id="cdct" scope="row"></td>
                            <td scope="row">µS/cm</td>
                        </tr>
                        <tr>
                            <td class="tdCenterAlign" scope="row">
                                Turbidity (Tur)
                            </td>
                            <td id="tbd_status" class="tdCenterAlign" scope="row"></td>
                            <td id="tbd" scope="row"></td>
                            <td scope="row">NTU</td>
                        </tr>
                        <tr>
                            <td class="tdCenterAlign" scope="row">
                                Instant Power Consumption
                            </td>
                            <td id="power_status" class="tdCenterAlign" scope="row">
                                -
                            </td>
                            <td id="power" scope="row"></td>
                            <td scope="row">kW</td>
                        </tr>
    
                        {% if (user == 'admin') or (user == 'superuser') %}
                        <tr>
                            <td class="tdCenterAlign" scope="row">
                                Average Current
                            </td>
                            <td id="AC_status" class="tdCenterAlign" scope="row"></td>
                            <td id="AC" scope="row"></td>
                            <td scope="row">A</td>
                        </tr>
                        {% endif %}
                        <tr>
                            <td class="tdCenterAlign" scope="row">Heat Capacity</td>
                            <td class="tdCenterAlign" scope="row">-</td>
                            <td id="heat_capacity" scope="row"></td>
                            <td scope="row">kW</td>
                        </tr>
                        <tr>
                            <td class="tdCenterAlign" scope="row">
                                Filter Inlet Pressure (P3)
                            </td>
                            <td id="prsr_fltIn_status" class="tdCenterAlign" scope="row"></td>
                            <td id="prsr_fltIn" scope="row"></td>
                            <td class="unit_pressure" scope="row"></td>
                        </tr>
                        <tr>
                            <td class="tdCenterAlign" scope="row">
                                Filter Outlet Pressure (P4)
                            </td>
                            <td id="prsr_fltOut_status" class="tdCenterAlign" scope="row"></td>
                            <td id="prsr_fltOut" scope="row"></td>
                            <td class="unit_pressure" scope="row"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    
        <div class="pumpValve title" data-label="Pump Information">
            <div class="data-before-trigger"></div>
            <div class="content">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th class="col-4 tdCenterAlign"></th>
                            <th class="col-3 tdCenterAlign">Status</th>
                            <th class="col-3 tdCenterAlign">Value</th>
                            <th class="col-2 tdCenterAlign">Unit</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="tdCenterAlign">Coolant Pump1</td>
                            <td class="tdCenterAlign" id="inv1_freq_status"></td>
                            <td class="tdCenterAlign" id="inv1_freq"></td>
                            <td>%</td>
                        </tr>
                        <tr>
                            <td class="tdCenterAlign">Coolant Pump2</td>
                            <td class="tdCenterAlign" id="inv2_freq_status"></td>
                            <td class="tdCenterAlign" id="inv2_freq"></td>
                            <td>%</td>
                        </tr>
                        <tr>
                            <td class="tdCenterAlign">Coolant Pump3</td>
                            <td class="tdCenterAlign" id="inv3_freq_status"></td>
                            <td class="tdCenterAlign"  id="inv3_freq" ></td>
                            <td>%</td>
                        </tr>
                        <!-- <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                Inverter 1 Error
                            </td>
                            <td id="Inv1_Error" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                Inverter 2 Error
                            </td>
                            <td id="Inv2_Error" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                Inverter 3 Error
                            </td>
                            <td id="Inv3_Error" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                Inverter 1 Overload
                            </td>
                            <td id="Inv1_OverLoad" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                Inverter 2 Overload
                            </td>
                            <td id="Inv2_OverLoad" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                Inverter 3 Overload
                            </td>
                            <td id="Inv3_OverLoad" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr> -->
                    </tbody>
                </table>
            </div>
        </div>
    
        <div class="fanValve title" data-label="Fan Information">
            <div class="data-before-trigger"></div>
            <div class="content">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th class="col-4 tdCenterAlign"></th>
                            <th class="col-3 tdCenterAlign">Status</th>
                            <th class="col-3 tdCenterAlign">Value</th>
                            <th class="col-2 tdCenterAlign">Unit</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="tdCenterAlign">Fan Speed 1</td>
                            <td  class="tdCenterAlign" id="fan_freq1_status"></td>
                            <td class="tdCenterAlign" id="fan_freq1"></td>
                            <td>%</td>
                        </tr>
                        <tr>
                            <td class="tdCenterAlign">Fan Speed 2</td>
                            <td  class="tdCenterAlign" id="fan_freq2_status"></td>
                            <td class="tdCenterAlign" id="fan_freq2"></td>
                            <td>%</td>
                        </tr>
                        <tr>
                            <td class="tdCenterAlign">Fan Speed 3</td>
                            <td  class="tdCenterAlign" id="fan_freq3_status"></td>
                            <td class="tdCenterAlign" id="fan_freq3"></td>
                            <td>%</td>
                        </tr>
                        <tr>
                            <td class="tdCenterAlign">Fan Speed 4</td>
                            <td  class="tdCenterAlign" id="fan_freq4_status"></td>
                            <td class="tdCenterAlign" id="fan_freq4"></td>
                            <td>%</td>
                        </tr>
                        <tr>
                            <td class="tdCenterAlign">Fan Speed 5</td>
                            <td  class="tdCenterAlign" id="fan_freq5_status"></td>
                            <td class="tdCenterAlign" id="fan_freq5"></td>
                            <td>%</td>
                        </tr>
                        <tr>
                            <td class="tdCenterAlign">Fan Speed 6</td>
                            <td  class="tdCenterAlign" id="fan_freq6_status"></td>
                            <td class="tdCenterAlign" id="fan_freq6"></td>
                            <td>%</td>
                        </tr>
                        <tr>
                            <td class="tdCenterAlign">Fan Speed 7</td>
                            <td  class="tdCenterAlign" id="fan_freq7_status"></td>
                            <td class="tdCenterAlign" id="fan_freq7"></td>
                            <td>%</td>
                        </tr>
                        <tr>
                            <td class="tdCenterAlign">Fan Speed 8</td>
                            <td  class="tdCenterAlign" id="fan_freq8_status"></td>
                            <td class="tdCenterAlign" id="fan_freq8"></td>
                            <td>%</td>
                        </tr>
    
                        <!-- <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                Fan Overload 1
                            </td>
                            <td id="Fan_OverLoad1" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                Fan Overload 2
                            </td>
                            <td id="Fan_OverLoad2" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                Fan 1 Alarm Status
                            </td>
                            <td id="fan1_error" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                Fan 2 Alarm Status
                            </td>
                            <td id="fan2_error" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                Fan 3 Alarm Status
                            </td>
                            <td id="fan3_error" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                Fan 4 Alarm Status
                            </td>
                            <td id="fan4_error" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                Fan 5 Alarm Status
                            </td>
                            <td id="fan5_error" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                Fan 6 Alarm Status
                            </td>
                            <td id="fan6_error" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                Fan 7 Alarm Status
                            </td>
                            <td id="fan7_error" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                Fan 8 Alarm Status
                            </td>
                            <td id="fan8_error" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr> -->
                    </tbody>
                </table>
            </div>
        </div>
        {% if (user == 'admin') or (user == 'superuser') %}
        <div class="mcInfo title" data-label="Magnetic Contactor Information">
            <div class="data-before-trigger"></div>
            <div class="content">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th class="col-4 tdCenterAlign"></th>
                            <th class="col-3 tdCenterAlign">Status</th>
                            <th class="col-3"></th>
                            <th class="col-2"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">Inverter 1 MC</td>
                            <td id="mc1_sw" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">Inverter 2 MC</td>
                            <td id="mc2_sw" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">Inverter 3 MC</td>
                            <td id="mc3_sw" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">Fan 1-4 MC</td>
                            <td id="fan_mc1" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">Fan 5-8 MC</td>
                            <td id="fan_mc2" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                Main MC
                            </td>
                            <td id="main_mc_error" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}
    
        <div class="deviceStatus title" data-label="Device Status">
            <div class="data-before-trigger"></div>
            <div class="content">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr class="row_sticky">
                            <th class="col-4 tdCenterAlign" scope="col">Sensor</th>
                            <th class="col-3 tdCenterAlign">Status</th>
                            <th class="col-3"></th>
                            <th class="col-2"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                Leakage Sensor
                            </td>
                            <td id="leakage1" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
    
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                Liquid Coolant Level 1
                            </td>
                            <td id="level1" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
    
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                Liquid Coolant Level 2
                            </td>
                            <td id="level2" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
    
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                Liquid Coolant Level 3
                            </td>
                            <td id="level3" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
    
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                24V Power Supply 1
                            </td>
                            <td id="power24v1" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
    
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                24V Power Supply 2
                            </td>
                            <td id="power24v2" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
    
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                12V Power Supply 1
                            </td>
                            <td id="power12v1" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
    
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">
                                12V Power Supply 2
                            </td>
                            <td id="power12v2" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
    
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">ATS</td>
                            <td id="ATS" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
    
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">PC1</td>
                            <td id="pc1_error" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="w-12 tdCenterAlign" scope="row">PC2</td>
                            <td id="pc2_error" class="w-12 tdCenterAlign" scope="row"></td>
                            <td scope="row"></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    
    
        <div class="rack_setting hidden title" data-label="Rack Information">
            <div class="data-before-trigger"></div>
            <div class="content">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th class="col-4 tdCenterAlign"></th>
                            <th class="col-3 tdCenterAlign">Opening (%)</th>
                            <th class="col-3 tdCenterAlign">Leakage</th>
                            <th class="col-2"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="rack1 hidden">
                            <td class="w-25 tdCenterAlign">Rack1</td>
                            <td id="rack1_status" class="w-25 tdCenterAlign"></td>
                            <td id="rack1_leak" class="w-25 tdCenterAlign"></td>
                            <td></td>
                        </tr>
                        <tr class="rack2 hidden">
                            <td class="w-25 tdCenterAlign">Rack2</td>
                            <td id="rack2_status" class="w-25 tdCenterAlign"></td>
                            <td id="rack2_leak" class="w-25 tdCenterAlign"></td>
                            <td></td>
                        </tr>
                        <tr class="rack3 hidden">
                            <td class="w-25 tdCenterAlign">Rack3</td>
                            <td id="rack3_status" class="w-25 tdCenterAlign"></td>
                            <td id="rack3_leak" class="w-25 tdCenterAlign"></td>
                            <td></td>
                        </tr>
                        <tr class="rack4 hidden">
                            <td class="w-25 tdCenterAlign">Rack4</td>
                            <td id="rack4_status" class="w-25 tdCenterAlign"></td>
                            <td id="rack4_leak" class="w-25 tdCenterAlign"></td>
                            <td></td>
                        </tr>
                        <tr class="rack5 hidden">
                            <td class="w-25 tdCenterAlign">Rack5</td>
                            <td id="rack5_status" class="w-25 tdCenterAlign"></td>
                            <td id="rack5_leak" class="w-25 tdCenterAlign"></td>
                            <td></td>
                        </tr>
                        <tr class="rack6 hidden">
                            <td class="w-25 tdCenterAlign">Rack6</td>
                            <td id="rack6_status" class="w-25 tdCenterAlign"></td>
                            <td id="rack6_leak" class="w-25 tdCenterAlign"></td>
                            <td></td>
                        </tr>
                        <tr class="rack7 hidden">
                            <td class="w-25 tdCenterAlign">Rack7</td>
                            <td id="rack7_status" class="w-25 tdCenterAlign"></td>
                            <td id="rack7_leak" class="w-25 tdCenterAlign"></td>
                            <td></td>
                        </tr>
                        <tr class="rack8 hidden">
                            <td class="w-25 tdCenterAlign">Rack8</td>
                            <td id="rack8_status" class="w-25 tdCenterAlign"></td>
                            <td id="rack8_leak" class="w-25 tdCenterAlign"></td>
                            <td></td>
                        </tr>
                        <tr class="rack9 hidden">
                            <td class="w-25 tdCenterAlign">Rack9</td>
                            <td id="rack9_status" class="w-25 tdCenterAlign"></td>
                            <td id="rack9_leak" class="w-25 tdCenterAlign"></td>
                            <td></td>
                        </tr>
                        <tr class="rack10 hidden">
                            <td class="w-25 tdCenterAlign">Rack10</td>
                            <td id="rack10_status" class="w-25 tdCenterAlign"></td>
                            <td id="rack10_leak" class="w-25 tdCenterAlign"></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endblock %} {% block scripts %}
    <script>
        function changeAgentVal() {
            document.getElementById("picpath").value =
                document.getElementById("inputFileAgent").value;
        }
    
        function cvtInputValue(val_in) {
            let val_cvt = val_in.replace(/[^0-9.]/g, "");
    
            const decimalPointIndex = val_cvt.indexOf(".");
            if (decimalPointIndex !== -1) {
                val_cvt =
                    val_cvt.slice(0, decimalPointIndex + 1) +
                    val_cvt.slice(decimalPointIndex + 1).replace(".", "");
            }
            return val_cvt;
        }
    
        function cvtInputValueNoPnt(val_in) {
            let val_cvt = val_in.replace(/[^0-9]/g, "");
    
            const decimalPointIndex = val_cvt.indexOf(".");
            if (decimalPointIndex !== -1) {
                val_cvt =
                    val_cvt.slice(0, decimalPointIndex + 1) +
                    val_cvt.slice(decimalPointIndex + 1).replace(".", "");
            }
            return val_cvt;
        }
    
        jQuery(document).ready(function () {
            let max_filterout = -Infinity;
            let userType = "{{user}}";
            let selectedValue = $("#opMod").val();
    
            jQuery(".pumpValve").attr("data-before", "Pump Information ▼");
            jQuery(".fanValve").attr("data-before", "Fan Information ▼");
            jQuery(".mcInfo").attr("data-before", "Magnetic Contactor Information ▼");
            jQuery(".deviceStatus").attr("data-before", "Device Status ▼");
            jQuery(".sensor").attr("data-before", "Sensor Value ▼");
            jQuery(".rack_setting").attr("data-before", "Rack Information ▼");
    
    
    
    
            function current_data(data) {
                console.log(data);
    
                for (let key in data["value"]) {
                    if (data["value"].hasOwnProperty(key)) {
                        let value = data["value"][key];
                        let inv1 = data["value"]["inv1_freq"];
                        let inv2 = data["value"]["inv2_freq"];
    
                        $(`#${key}`).css("color", "black");
                        $(`#${key}_image`).css("color", "black");
                        $(`#${key}_status`).css("color", "black").text("Valid");
    
                        if (key.includes("flow") || key.includes("freq")) {
                            $("#" + key).text(value.toFixed(0));
                            $("#" + key + "_image").text(value.toFixed(0));
                            if (inv1 > 100 || inv2 > 100) {
                                $("#" + key).text(100);
                                $("#" + key + "_image").test(100);
                            }
                        } else {
                            $("#" + key).text(
                                value.toFixed(userType == "superuser" ? 2 : 1)
                            );
                            $(`#${key}_image`).text(
                                value.toFixed(userType == "superuser" ? 2 : 1)
                            );
                        }
                    }
                }
    
                for (let key in data["ats_status"]) {
                    if (data["ats_status"].hasOwnProperty(key)) {
                        let value = data["ats_status"][key];
                        if (key == "ATS1" && value) {
                            $("#ATS").css("color", "black").text("Primary");
                        } else if (key == "ATS2" && !data["ats_status"]["ATS1"]) {
                            let ats_status = value ? "Secondary" : "OFF";
                            $("#ATS").css("color", "black").text(ats_status);
                        }
                    }
                }
    
                for (let key in data["unit"]) {
                    if (data["unit"].hasOwnProperty(key)) {
                        let value = data["unit"][key];
                        $("." + key).text(value);
                    }
                }
    
                for (let key in data["mc"]) {
                    if (data["mc"].hasOwnProperty(key)) {
                        let value = data["mc"][key];
                        $("#" + key).text(value ? "ON" : "OFF");
                    }
                }
    
                $(".t1sp_set").hide();
                $(".p1sp_set").hide();
                $(".p2sp_set").hide();
    
                if (userType != "superuser") {
                    for (let key in data["collapse"]) {
                        if (data["collapse"].hasOwnProperty(key)) {
                            let value = data["collapse"][key];
                            if (key.includes("_show_final")) {
                                let main_key = key.replace("_show_final", "");
                                if (value) {
                                    $("." + main_key + "_set").show();
                                }
                            }
                        }
                    }
                } else {
                    $(".t1sp_set").show();
                    $(".p1sp_set").show();
                    $(".p2sp_set").show();
                }
    
                for (let key in data["warning_notice"]) {
                    if (data["warning_notice"].hasOwnProperty(key)) {
                        let status_w = data["warning_notice"][key];
                        let status_a = data["alert_notice"][key];
    
                        if (status_a === true) {
                            $("#" + key + "_status")
                                .css("color", "red")
                                .text("Alert Level");
                        } else if (status_w === true) {
                            $("#" + key + "_status")
                                .css("color", "#F39C12")
                                .text("Warning Level");
                        } else {
                            $("#" + key + "_status")
                                .css("color", "black")
                                .text("Valid");
                        }
                    }
                }
    
                for (let key in data["error"]) {
                    if (data["error"].hasOwnProperty(key)) {
                        let value = data["error"][key];
                        let $device = $("#" + key);
    
                        if (
                            $device &&
                            !key.includes("_Com") &&
                            !key.includes("_broken")
                        ) {
                            if (value == true) {
                                $device.css("color", "red").text("Device Error");
                            } else {
                                $device.css("color", "black").text("OK");
                            }
    
                            if (key.includes("leakage1")) {
                                if (data["error"]["leakage1_broken"]) {
                                    $("#leakage1")
                                        .css("color", "red")
                                        .text("Broken");
                                } else if (
                                    !data["error"]["leakage1_broken"] &&
                                    data["error"]["leakage1_leak"]
                                ) {
                                    $("#leakage1").css("color", "red").text("Leak");
                                } else {
                                    $("#leakage1").css("color", "black").text("OK");
                                }
                            }
                        }
    
                        let broken_mapping = {
                            PrsrClntRtn_broken: "prsr_clntRtn",
                            PrsrClntRtnSpare_broken: "prsr_clntRtnSpare",
                            PrsrClntSply_broken: "prsr_clntSply",
                            PrsrClntSplySpare_broken: "prsr_clntSplySpare",
                            TempClntRtn_broken: "temp_clntRtn",
                            TempClntRtnSpare_broken: "temp_clntRtnSpare",
                            TempClntSply_broken: "temp_clntSply",
                            TempClntSplySpare_broken: "temp_clntSplySpare",
                            PrsrFltIn_broken: "prsr_fltIn",
                            PrsrFltOut_broken: "prsr_fltOut",
                            Clnt_Flow_broken: "clnt_flow",
                        };
    
                        for (const [broken_key, local_value] of Object.entries(
                            broken_mapping
                        )) {
                            let status_element = $(`#${local_value}_status`);
                            let local_element = $(`#${local_value}`);
                            let local_element_image = $(`#${local_value}_image`);
    
                            if (key === broken_key) {
                                if (value) {
                                    status_element
                                        .css("color", "red")
                                        .text("Broken Error");
                                    local_element.css("color", "red").text("-");
                                    local_element_image.css("color", "red").text("-");
                                }
                            }
                        }
    
                        let com_mapping = {
                            "Inv1_Com": "inv1_freq",
                            "Inv2_Com": "inv2_freq",
                            "Inv3_Com": "inv3_freq",
                            "Clnt_Flow_Com": "clnt_flow",
                            "Ambient_Temp_Com": "ambient_temp",
                            "Relative_Humid_Com": "relative_humid",
                            "Dew_Point_Com": "dew_point",
                            "Cdct_Sensor_Com": "cdct",
                            "pH_Com": "pH",
                            "Tbd_Com": "tbd",
                            "ATS1_Com": "ATS",
                            "ATS2_Com": "ATS",
                            "Power_Meter_Com": "power",
                            "Average_Current_Com": "AC",
                            "Fan1_Com": "fan_freq1",
                            "Fan2_Com": "fan_freq2",
                            "Fan3_Com": "fan_freq3",
                            "Fan4_Com": "fan_freq4",
                            "Fan5_Com": "fan_freq5",
                            "Fan6_Com": "fan_freq6",
                            "Fan7_Com": "fan_freq7",
                            "Fan8_Com": "fan_freq8",
                        };
                        
    
                        for (const [com_key, local_value] of Object.entries(
                            com_mapping
                        )) {
                            let status_element = $(`#${local_value}_status`);
                            let local_element = $(`#${local_value}`);
                            let local_element_image = $(`#${local_value}_image`);
                            if(key === com_key){
                                if (key.startsWith('Inv') || key.startsWith('Fan')) {
                                    if (value) {
                                        status_element.css("color", "red").text("Comm Error");
                                        local_element.css("color", "red").text("-");
                                        local_element_image.css("color", "red").text("-");
                                    }      
                                }
                                else{
                                    status_element
                                        .css("color", "red")
                                        .text("Comm Error");
                                    local_element.css("color", "red").text("-");
                                    local_element_image.css("color", "red").text("-");
                                }
                            }
                        }
    
                        let Error_mapping = {
                            "Inv1_Error": "inv1_freq",
                            "Inv2_Error": "inv2_freq",
                            "Inv3_Error": "inv3_freq",
                            "Inv1_OverLoad": "inv1_freq",
                            "Inv2_OverLoad": "inv2_freq",
                            "Inv3_OverLoad": "inv3_freq",
                        };
    
                        for (const [error_key, local_value] of Object.entries(Error_mapping)) {
                            let status_element = $(`#${local_value}_status`);
                            let local_element = $(`#${local_value}`);
                            let local_element_image = $(`#${local_value}_image`);
                            
                            //consloe.log("local_value: ", local_value)
                            if(key === error_key){
                                //console.log("key: ", key, " value: ", value)
                                if (key.includes("OverLoad") && value) {
                                    status_element.css("color", "red").text("OverLoad");
                                    local_element.css("color", "red").text("-");
                                    local_element_image.css("color", "red").text("-");
                                }
                                else if (key.includes("Error") && value) {
                                    //console.log("key: ", key , "value: ", value)
                                    status_element.css("color", "red").text("Error");
                                    local_element.css("color", "red").text("-");
                                    local_element_image.css("color", "red").text("-");
                                }
    
                            }
    
                        }
                        
    
                        
    
                        if (data["error"]["PLC"]) {
                            const exclude_keys = [
                                "clnt_flow",
                                "pH",
                                "cdct",
                                "tbd",
                                "power",
                                "inv1_freq",
                                "inv2_freq",
                                "inv3_freq",
                                "fan_freq",
                                "heat_capacity",
                                "AC",
                            ];
    
                            for (let key in data["value"]) {
                                if (data["value"].hasOwnProperty(key)) {
                                    if (exclude_keys.includes(key)) {
                                        continue;
                                    }
                                    let status_value = `${key}_status`;
                                    $(`#${status_value}`)
                                        .css("color", "red")
                                        .text("PLC Error");
                                    $(`#${key}`).css("color", "red").text("-");
                                }
                            }
                        }
                    }
                }
    
    
    
                //Fillter計算
                let fillter_val;
    
                let p3 = !data["error"]["PrsrFltIn_broken"]
                    ? data["value"]["prsr_fltIn"]
                    : "-";
    
                let p4 = !data["error"]["PrsrFltOut_broken"]
                    ? data["value"]["prsr_fltOut"]
                    : "-";
    
                if (p3 == "-" || p4 == "-") {
                    fillter_val = "-";
                    $("#prsr_fltDiff_image").text("-").css("color", "red");
                } else {
                    fillter_val = p4 - p3;
    
                    if (userType == "superuser") {
                        fillter_val = parseFloat(fillter_val).toFixed(2);
                    } else {
                        fillter_val = parseFloat(fillter_val).toFixed(1);
                    }
                    $("#prsr_fltDiff_image").css("color", "black").text(fillter_val);
                }
    
                //PD計算
                let prsr_diff;
    
                let p1 = !data["error"]["PrsrClntSply_broken"]
                    ? data["value"]["prsr_clntSply"]
                    : !data["error"]["PrsrClntSplySpare_broken"]
                        ? data["value"]["prsr_clntSplySpare"]
                        : "-";
    
                let p2 = !data["error"]["PrsrClntRtn_broken"]
                    ? data["value"]["prsr_clntRtn"]
                    : !data["error"]["PrsrClntRtnSpare_broken"]
                        ? data["value"]["prsr_clntRtnSpare"]
                        : "-";
    
                if (p1 == data["value"]["prsr_clntSplySpare"]) {
                    $("#prsr_clntSply_image").css("color", "black").text(
                        p1.toFixed(userType == "superuser" ? 2 : 1)
                    );
                }
    
                if (p2 == data["value"]["prsr_clntRtnSpare"]) {
                    $("#prsr_clntRtn_image").css("color", "black").text(
                        p2.toFixed(userType == "superuser" ? 2 : 1)
                    );
                }
    
                if (p1 == "-" || p2 == "-") {
                    prsr_diff = "-";
                } else {
                    prsr_diff = p1 - p2;
    
                    if (userType == "superuser") {
                        prsr_diff = parseFloat(prsr_diff).toFixed(2);
                    } else {
                        prsr_diff = parseFloat(prsr_diff).toFixed(1);
                    }
                }
    
                if (prsr_diff == "-") {
                    $("#prsr_diff").text("-").css("color", "red");
                    $("#prsr_diff_image").text("-").css("color", "red");
                } else {
                    $("#prsr_diff").css("color", "black").text(prsr_diff);
                    $("#prsr_diff_image").css("color", "black").text(prsr_diff);
                }
    
                for (let key in data["rack_status"]) {
                    if (data["rack_status"].hasOwnProperty(key)) {
                        let value = data["rack_status"][key];
                        $("#" + key)
                            .text(value.toFixed(0))
                            .css("color", "black");
                    }
                }
    
                for (let key in data["rack_leak"]) {
                    if (data["rack_leak"].hasOwnProperty(key)) {
                        let value = data["rack_leak"][key];
                        let value_key = key.replace("_leak", "_status");
                        $("#" + key)
                            .text(value ? "OK" : "Leak")
                            .css("color", value ? "black" : "red");
                    }
                }
    
                for (let key in data["rack_broken"]) {
                    if (data["rack_broken"].hasOwnProperty(key)) {
                        let value = data["rack_broken"][key];
                        let assign_key = key.replace("_broken", "_leak");
                        let value_key = key.replace("_broken", "_status");
                        if (!value) {
                            $("#" + assign_key)
                                .text("Broken")
                                .css("color", "red");
                        }
                    }
                }
    
                for (let key in data["rack_no_connection"]) {
                    if (data["rack_no_connection"].hasOwnProperty(key)) {
                        let value = data["rack_no_connection"][key];
                        if (key.includes("_status")) {
                            if (value) {
                                $("#" + key)
                                    .text("Comm Error")
                                    .css("color", "red");
                            }
                        }
    
                        if (key.includes("_leak")) {
                            if (value) {
                                $("#" + key)
                                    .text("Comm Error")
                                    .css("color", "red");
                            }
                        }
                    }
                }
            }
    
            function change_status_light(data) {
                let light_orange = [];
                $(".status_light").css("background-color", "black");
    
                for (key in data["warning_notice"]) {
                    let w_value = data["warning_notice"][key];
    
                    if (w_value) {
                        $(".status_light").css("background-color", "red");
                    }
                }
    
                for (key in data["alert_notice"]) {
                    let a_value = data["alert_notice"][key];
    
                    if (a_value) {
                        $(".status_light").css("background-color", "red");
                    }
                }
    
                for (key in data["error"]) {
                    let e_value = data["error"][key];
    
                    if (key != "ATS1") {
                        if (e_value) {
                            $(".status_light").css("background-color", "red");
                        }
                    }
                }
            }
    
            async function fetch_get_data() {
                while (true) {
                    try {
                        const data = await $.ajax({
                            url: "/get_data",
                            method: "GET",
                            loader: false,
                            timeout: 10000,
                            dataType: "json",
                        });
    
                        current_data(data);
                        change_status_light(data);
                    } catch (xhr) {
                        console.error(
                            `AJAX request failed with status: ${xhr.status} - ${xhr.statusText}`
                        );
                    }
    
                    await new Promise((resolve) => setTimeout(resolve, 2000));
                }
            }
    
            fetch_get_data();
    
            async function fetch_get_data_control() {
                while (true) {
                    try {
                        const data = await $.ajax({
                            url: "/get_data_control",
                            method: "GET",
                            loader: false,
                            timeout: 10000,
                            dataType: "json",
                        });
    
                        for (let key in data["rack_visibility"]) {
                            if (data["rack_visibility"].hasOwnProperty(key)) {
                                let value = data["rack_visibility"][key];
                                let rack_key = key.replace("_enable", "");
    
                                if (value) {
                                    $("." + rack_key).show();
                                } else {
                                    $("." + rack_key).hide();
                                }
                            }
                            let allFalse = Object.values(
                                data["rack_visibility"]
                            ).every((value) => value === false);
    
                            if (allFalse) {
                                $(".rack_setting").hide();
                            } else {
                                $(".rack_setting").show();
                            }
                        }
    
                        $(".current_mode").text(data["value"]["resultMode"]);
                    } catch (xhr) {
                        console.error(
                            `AJAX request failed with status: ${xhr.status} - ${xhr.statusText}`
                        );
                    }
    
                    await new Promise((resolve) => setTimeout(resolve, 2000));
                }
            }
    
            fetch_get_data_control();
    
            $(".title").each(function () {
                if ($(this).data("default") === "collapsed") {
                    $(this).addClass("collapsed");
                }
            });
    
            $(".data-before-trigger").click(function () {
                let $title = $(this).closest(".title");
                $title.toggleClass("collapsed");
                if ($title.hasClass("collapsed")) {
                    $title.attr("data-before", $title.attr("data-label") + " ▲");
                } else {
                    $title.attr("data-before", $title.attr("data-label") + " ▼");
                }
            });
        });
    </script>
    <script></script>
    {% endblock %}